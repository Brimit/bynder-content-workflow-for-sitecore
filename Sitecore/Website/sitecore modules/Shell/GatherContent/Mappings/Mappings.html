<script src="/sitecore modules/shell/GatherContent/js/jquery_2.1.1.min.js"></script>
<script src="/sitecore/shell/Controls/Lib/Prototype/prototype.js"></script>
<script src="/sitecore/shell/Controls/Browser.js"></script>
<script src="/sitecore/shell/Controls/Sitecore.js"></script>
<!--<script src="/sitecore modules/shell/GatherContent/Mappings/Mappings.js"></script>-->
<script src="/sitecore modules/shell/GatherContent/js/knockout-3.4.0.js"></script>
<script src="/sitecore modules/shell/GatherContent/js/GatherContent.js"></script>
<link href="/sitecore modules/shell/GatherContent/css/GatherContent.css" rel="stylesheet" />
<script type="text/javascript">
    $.noConflict();
</script>
<script type="text/JavaScript" language="javascript">
    if (!window.scSitecore) {
        scSitecore = function () { };
    }
    scSitecore.prototype.Settings = {};
    scSitecore.prototype.Settings.SessionTimeout = 1200000;
</script>

<div class="gathercontent-dialog">
    <h1>
        Manage template mappings
    </h1>
    <h2>
        Choose which template you wish to manage. If the template you wish to work with isn't showing up please
    </h2>
    <div class="table_mappings_wrapper">
        <div class="table_mappings_scroll">
            <table style="width:100%">
                <thead>
                    <tr>
                        <th>
                            GC Project
                            <div>GC Project</div>
                        </th>
                        <th>
                            GC template
                            <div>GC template</div>
                        </th>
                        <th>
                            Sitecore Template
                            <div>Sitecore Template</div>
                        </th>
                        <th>
                            Last mapped
                            <div>Last mapped</div>
                        </th>
                        <th>
                            Last updated in GC
                            <div>Last updated in GC</div>
                        </th>
                        <th>
                            <div></div>
                        </th>
                    </tr>
                </thead>
                <tbody data-bind="foreach: mappings">
                    <tr>
                        <td data-bind="text: GcProjectName, style: { color: IsMapped ? 'black': 'red' }"></td>
                        <td data-bind="text: GcTemplateName, style: { color: IsMapped ? 'black': 'red' }"></td>
                        <td data-bind="text: ScTemplateName, style: { color: IsMapped ? 'black': 'red' }"></td>
                        <td data-bind="text: LastMappedDateTime, style: { color: IsMapped ? 'black': 'red' }"></td>
                        <td data-bind="text: LastUpdatedDate"></td>
                        <td><a href="#" data-bind="click: editMapping, text: EditButtonTitle">Edit</a></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <input class="mappings-btn" id="AddMore" type="button" value="Add more template" data-bind="click: addMoreTemplates" />
    <h2>
        Don't see the template you want to map? Make sure yau are in the right project, and try adding it from GC
    </h2>
</div>

<script>

    // console.log(window.frameElement.src);
    // console.log(location.href);

    var id = getUrlVars()["id"];
    jQuery.getJSON('/sitecore/api/mappings?id={' + id + '}', null, function (data) {
        var viewModel = {
            mappings: ko.observableArray(data)
        };
        ko.applyBindings(viewModel);
    });


    editMapping = function () {
        var id = this.GcTemplateId;
        openMappingWindow(id);
    }


    addMoreTemplates = function () {
        openTemplateWindow();
    }



    function openTemplateWindow() {
        var id = getUrlVars()["id"];
        scForm.showModalDialog("/sitecore modules/shell/gathercontent/AddTemplate/AddTemplate.html?id=" + id, null, "center:yes;help:no;resizable:yes;scroll:yes;status:no;dialogMinHeight:400;dialogMinWidth:600;dialogWidth:800;dialogHeight:600;header: Setup template mapping");
    };


    function openMappingWindow(id) {
        scForm.showModalDialog("/sitecore modules/shell/gathercontent/Mappings/AddOrUpdateMapping.html?id=" + id,
            null, "center:yes;help:no;resizable:yes;scroll:yes;status:no;dialogMinHeight:400;dialogMinWidth:600;dialogWidth:800;dialogHeight:600;header: Manage template mappings");
    };



</script>